<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <!-- StAuth10244: I Hope Hemingway, 000912927 certify that this material is my original work. No other person's work has been us ed without due acknowledgement. I have not made my work available to anyone else. -->
    <title>Cards!</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body{
        background-color: #DDA0DD;
      }
      img{
        margin: 3px;
        border: 4px solid #DDA0DD;
      }
      .picked{
        border: 4px solid #9400D3;
      }
    </style>
  </head>
  <body>


    <ul id="myList"></ul>

    <script type="text/babel">

      //import { useState } from 'react';

      const suits = ["CLUBS","HEARTS","SPADES","DIAMONDS"];
      const handContext = React.createContext()
      //const deckSetContext = React.createContext()
      var hide = ""
      var hasCards = "";
      var picked = null;

      function createDeck(){
        let deck = [];
        for(let i=0; i<suits.length; i++){
          for(let value=1; value<14; value++){
            let name = "images/" + suits[i] + value + ".jpg";
            let id = suits[i][0] + value;
            deck.push(<Card key={id} id={id} src={name} />);
          }
        }
        for (let i = deck.length - 1; i > 0; i--) { 
            const j = Math.floor(Math.random() * (i + 1)); 
            [deck[i], deck[j]] = [deck[j], deck[i]]; 
          }
        return deck;
      }

      function Card(props){
        let hand = React.useContext(handContext)

        function pickHandler(event){
          if (picked == null){
            pick(event)
          }else if (picked != null && event.target.className == "picked")
            unpick()
          else
            console.log(picked.id, findCardIndex(picked.id), event.currentTarget.id, findCardIndex(event.currentTarget.id))
        }

        function pick(event){
          event.target.className = "picked"
          picked = event.target;
        }

        function unpick(){
          picked.className = null
          picked = null
        }

        async function swapCards(event){
          hand.swapCards(picked.id, event.currentTarget.id)
        
          }
      
        function findCardIndex(id){
          let i = 0
          let found = false;

          while(hand[i].props.id !=id && i<hand.length){
            i++;
            if (hand[i].props.id ==id){
              found = true;
            }
          }

          if (!found)
            return -1;
          return i;
        }

        return <img onClick={pickHandler} id={props.id} src={props.src}/>;
      }

      

      const deck = createDeck();

      function Hand(){
        // deck = React.useContext(deckContext)
        // setDeck = React.useContext(deskSetContext)
        // const deck = createDeck();
        console.log(deck)
        const [hand, setHand] = React.useState([]);

        // function createDeck(){
        //   let deck = [];
        //   for(let i=0; i<suits.length; i++){
        //     for(let value=1; value<14; value++){
        //       let name = "images/" + suits[i] + value + ".jpg";
        //       let id = suits[i][0] + value;
        //       deck.push(<Card key={id} id={id} src={name} />);
        //     }
        //   }
        //   for (let i = deck.length - 1; i > 0; i--) { 
        //       const j = Math.floor(Math.random() * (i + 1)); 
        //       [deck[i], deck[j]] = [deck[j], deck[i]]; 
        //     }
        //   return deck;
        // }
        
        // function Card(props){
        //   return <img onClick={pickHandler} id={props.id} src={props.src}/>;
        // }

        async function addCard(){
          await setHand(hand =>[
            ...hand,
            deck[0]
          ]);
          // console.log(deck[0])
          deck.shift();
          if(deck.length == 0){
            hasCards = <p>no cards remaining</p>

            hide = "hidden";
          }
        }
        
        async function addFive(){
          await reset()
          for(let i=0; i<5; i++){
            await addCard()
          }
        }

        async function addSeven(){
          await reset()
          for(let i=0; i<7; i++){
            await addCard()
          }
        }

        async function reset(){
          // put hand back in deck
          for (let i=0; i<hand.length; i++){
            deck.push(hand[i])
          }
          hide = ""
          hasCards = ""

          // empty hand
          await setHand(hand =>[]);

          //shuffle
          for (let i = deck.length - 1; i > 0; i--) { 
            const j = Math.floor(Math.random() * (i + 1)); 
            [deck[i], deck[j]] = [deck[j], deck[i]]; 
          } ; 
        }

        async function swapCards(index1, index2){
          console.log("start", hand)
          const tempHand = [];

          for(let i=0; i<hand.length; i++){
            tempHand[i] = hand[i];
          }
          tempHand[index1] = hand[index2];
          tempHand[index2] = hand[index1];
          console.log("temp", tempHand);

          await setHand(hand => {
            hand = [...tempHand];
            console.log("in")
          });
          console.log("hand set", hand)
        }
      //   function pickHandler(event){
      //     if (picked == null){
      //       pick(event)

      //       console.log(hand.findLastIndex(findCardIndex, event.currentTarget.id))
      //     }else if (picked != null && event.target.className == "picked"){
      //       unpick(event)
      //     }else{
      //       swapCards(event)
      //  } }

      //   function pick(event){
      //     event.target.className = "picked"
      //     picked = event.target;
      //   }

      //   function unpick(event){
      //     picked.className = null
      //     picked = null
      //   }

      //   async function swapCards(event){
      //     console.log("start", hand)
      //     let clickI = hand.indexOf(event.target);
      //     let pickI = hand.indexOf(picked);
      //     const tempHand = [];

      //     console.log("pick",pickI)
      //     console.log("click",clickI)

      //     for(let i=0; i<hand.length; i++){
      //       tempHand[i] = hand[i];
      //     }
      //     tempHand[pickI] = hand[clickI];
      //     tempHand[clickI] = hand[pickI];
      //     console.log("temp", tempHand);

      //     await setHand(hand => {
      //       hand = [...tempHand];
      //       console.log("in")
      //     });
      //     console.log("hand set", hand)
      
      //   }

        // function findCardIndex(id){

        //   console.log("id",id.props.id,"this",this)
        //   console.log(id.props.id == this)
        //   return id.props.id == this;

        // }
        

        let handDisplay = hand.map((card, index) => (
                {card}
              ))

        return(
          <>
            <div onClick={addCard} ><img src="images/TOP.jpg" hidden={hide}/>{hasCards}</div>
            <button onClick={addFive}>Deal 5</button>
            <button onClick={addSeven}>Deal 7</button>
            <button onClick={reset}>Reset</button>
            <button>Toss</button>
            <button>Wildcard</button>
            <button>Regroup</button>
            <handContext.Provider value={hand}>
            <div>
              {hand}
            </div>
            </handContext.Provider>
          </>
          
        )
      }


      //const deck = createDeck();
      
      const hand = [];
      
      const container = document.getElementById('myList');
      const root = ReactDOM.createRoot(container);
      root.render(
        <div>
          <Hand />
        </div>
      );
      //console.log(deck)

      
    </script>

  </body>
</html>






